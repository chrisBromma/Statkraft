/****************************************************************************************************
* Class msPaymentControllerTest
*
*   Create By	:   Steffen Naundorf (mindsquare GmbH)
*   Create Date	:   11.10.2018
*   Description	:	
*
*   Modification Log:
*   -------------------------------------------------------------------------------------------------
*   * Developer                        	   Date             	Description
*   * -----------------------------------------------------------------------------------------------                 
*   * Steffen Naundorf (mindsquare GmbH)   11.10.2018      	    Init version.
*****************************************************************************************************/

@IsTest
private class msPaymentControllerTest {

    
        @TestSetup private static void testSetup() {
        msTestDataFactory.createTestPortalContext();
        }

    @isTest
    private static void testGetPayment() {
         

        /*Contact usercontact = new Contact();
        usercontact.LastName = 'Last Test';
        insert usercontact;*/
        
        /*User testUser = new User();
        testUser.ProfileId = ProfileRecId;
        testUser.Username = 'DEtestuser@statkraft.mindsquare.de';
		testUser.Email = 'testuser@mindsquare.de';
		testUser.EmailEncodingKey = 'ISO-8859-1';
		testUser.LocaleSidKey = 'de_DE_EURO';
		testUser.LanguageLocaleKey = 'en_US';
		testUser.TimeZoneSidKey = 'Europe/Berlin';
		testUser.Alias = 'tstDEusr';
		testUser.LastName = 'DEuser';
		testUser.MobilePhone = '+49123456789';
		testUser.IsActive = true;
        //testUser.ContactId = usercontact.Id;
        testUser.UserRoleId = '00E1v000000G8DWEA0';

        insert testUser;*/
        User testUser = [SELECT Id, Name, ContactId FROM User WHERE Username = 'DEtestuser@statkraft.mindsquare.apex.testuser.statkraftportal'];
        Map<String, HttpResponse> endpointToResponseMap = new Map<String, HttpResponse>();
        HttpResponse responseSuccess = new msCalloutMock.MockResponseBuilder()
                .setBody('[{"kunnr":"0000081599","cp":"100010","fkdat":"20190604","bukrs":"3058","blart":"MI","vbelnVf":"9058207163","bldat":"20190604","wrbtr":"31649.85","waers":"EUR","augdt":"20190621","augbl":"0200046617","zfbdt":"20190621","bvtyp":"9006","sgtxt":"201905-201905 FR CDR-CP_FR_100010_1","reBillingid":"0000279184"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190621","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20190621","wrbtr":"-33069.07","waers":"EUR","augdt":"20190621","augbl":"0200046617","zfbdt":"20190621","bvtyp":"","sgtxt":"","reBillingid":"90621-Q5811"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190630","bukrs":"3058","blart":"MI","vbelnVf":"9058210905","bldat":"20190630","wrbtr":"32563.26","waers":"EUR","augdt":"20190722","augbl":"0200056867","zfbdt":"20190722","bvtyp":"9006","sgtxt":"201905-201905 FR CDR-CP_FR_100010_1","reBillingid":"0000282713"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190630","bukrs":"3058","blart":"MK","vbelnVf":"9058210898","bldat":"20190630","wrbtr":"-31649.85","waers":"EUR","augdt":"20190722","augbl":"0200056867","zfbdt":"20190621","bvtyp":"9006","sgtxt":"201905-201905 FR CDR-CP_FR_100010_1","reBillingid":"0000279184"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190630","bukrs":"3058","blart":"MI","vbelnVf":"9058210879","bldat":"20190630","wrbtr":"24365.62","waers":"EUR","augdt":"20190722","augbl":"0200056867","zfbdt":"20190722","bvtyp":"9006","sgtxt":"201906-201906 FR CDR-CP_FR_100010_1","reBillingid":"0000282686"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190715","bukrs":"3058","blart":"MI","vbelnVf":"9058212600","bldat":"20190715","wrbtr":"-370.00","waers":"EUR","augdt":"20190920","augbl":"0200075123","zfbdt":"20190820","bvtyp":"9006","sgtxt":"201901-201912 FR SEC_FEE_100010_FR","reBillingid":"0000284276"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190722","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20190722","wrbtr":"-25279.03","waers":"EUR","augdt":"20190722","augbl":"0200056867","zfbdt":"20190722","bvtyp":"","sgtxt":"","reBillingid":"90722-Q5811"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190731","bukrs":"3058","blart":"MI","vbelnVf":"9058214108","bldat":"20190731","wrbtr":"24030.09","waers":"EUR","augdt":"20190820","augbl":"0200066550","zfbdt":"20190820","bvtyp":"9006","sgtxt":"201906-201906 FR CDR-CP_FR_100010_1","reBillingid":"0000285991"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190731","bukrs":"3058","blart":"MK","vbelnVf":"9058214106","bldat":"20190731","wrbtr":"-24365.62","waers":"EUR","augdt":"20190820","augbl":"0200066550","zfbdt":"20190722","bvtyp":"9006","sgtxt":"201906-201906 FR CDR-CP_FR_100010_1","reBillingid":"0000282686"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190731","bukrs":"3058","blart":"MI","vbelnVf":"9058214586","bldat":"20190731","wrbtr":"24656.55","waers":"EUR","augdt":"20190820","augbl":"0200066550","zfbdt":"20190820","bvtyp":"9006","sgtxt":"201907-201907 FR CDR-CP_FR_100010_1","reBillingid":"0000286015"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190820","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20190820","wrbtr":"-24321.02","waers":"EUR","augdt":"20190820","augbl":"0200066550","zfbdt":"20190820","bvtyp":"","sgtxt":"","reBillingid":"90820-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MI","vbelnVf":"9058217013","bldat":"20190831","wrbtr":"22072.24","waers":"EUR","augdt":"20190831","augbl":"0003901538","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201908-201908 FR CDR-CP_FR_100010_1","reBillingid":"0000289175"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MK","vbelnVf":"9058217568","bldat":"20190831","wrbtr":"-22072.24","waers":"EUR","augdt":"20190831","augbl":"0003901538","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201908-201908 FR CDR-CP_FR_100010_1","reBillingid":"0000289175"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MI","vbelnVf":"9058216995","bldat":"20190831","wrbtr":"18970.83","waers":"EUR","augdt":"20190831","augbl":"0003901520","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201907-201907 FR CDR-CP_FR_100010_1","reBillingid":"0000289144"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MK","vbelnVf":"9058217550","bldat":"20190831","wrbtr":"-18970.83","waers":"EUR","augdt":"20190831","augbl":"0003901520","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201907-201907 FR CDR-CP_FR_100010_1","reBillingid":"0000289144"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MI","vbelnVf":"9058217665","bldat":"20190831","wrbtr":"28520.79","waers":"EUR","augdt":"20190920","augbl":"0200075123","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201908-201908 FR CDR-CP_FR_100010_1","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MI","vbelnVf":"9058217637","bldat":"20190831","wrbtr":"24513.28","waers":"EUR","augdt":"20190920","augbl":"0200075123","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201907-201907 FR CDR-CP_FR_100010_1","reBillingid":"0000289144"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190831","bukrs":"3058","blart":"MK","vbelnVf":"9058216965","bldat":"20190831","wrbtr":"-24656.55","waers":"EUR","augdt":"20190920","augbl":"0200075123","zfbdt":"20190820","bvtyp":"9006","sgtxt":"201907-201907 FR CDR-CP_FR_100010_1","reBillingid":"0000286015"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190920","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20190920","wrbtr":"-28007.52","waers":"EUR","augdt":"20190920","augbl":"0200075123","zfbdt":"20190920","bvtyp":"","sgtxt":"","reBillingid":"90920-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190930","bukrs":"3058","blart":"MI","vbelnVf":"9058220453","bldat":"20190930","wrbtr":"27891.89","waers":"EUR","augdt":"20191021","augbl":"0200084325","zfbdt":"20191021","bvtyp":"9006","sgtxt":"201908-201908 FR CDR-CP_FR_100010_1","reBillingid":"0000293504"},{"kunnr":"0000081599","cp":"100010","fkdat":"20190930","bukrs":"3058","blart":"MI","vbelnVf":"9058220489","bldat":"20190930","wrbtr":"40369.92","waers":"EUR","augdt":"20191021","augbl":"0200084325","zfbdt":"20191021","bvtyp":"9006","sgtxt":"201909-201909 FR CDR-CP_FR_100010_1","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20190930","bukrs":"3058","blart":"MK","vbelnVf":"9058220419","bldat":"20190930","wrbtr":"-28520.79","waers":"EUR","augdt":"20191021","augbl":"0200084325","zfbdt":"20190920","bvtyp":"9006","sgtxt":"201908-201908 FR CDR-CP_FR_100010_1","reBillingid":"0000289175"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191021","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20191021","wrbtr":"-39741.02","waers":"EUR","augdt":"20191021","augbl":"0200084325","zfbdt":"20191021","bvtyp":"","sgtxt":"","reBillingid":"91021-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191031","bukrs":"3058","blart":"MI","vbelnVf":"9058223596","bldat":"20191031","wrbtr":"40346.21","waers":"EUR","augdt":"20191120","augbl":"0200093926","zfbdt":"20191120","bvtyp":"9006","sgtxt":"201909-201909 FR CDR-CP_FR_100010_1","reBillingid":"0000296769"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191031","bukrs":"3058","blart":"MK","vbelnVf":"9058223553","bldat":"20191031","wrbtr":"-40369.92","waers":"EUR","augdt":"20191120","augbl":"0200093926","zfbdt":"20191021","bvtyp":"9006","sgtxt":"201909-201909 FR CDR-CP_FR_100010_1","reBillingid":"0000293540"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191031","bukrs":"3058","blart":"MI","vbelnVf":"9058223623","bldat":"20191031","wrbtr":"53608.43","waers":"EUR","augdt":"20191120","augbl":"0200093926","zfbdt":"20191120","bvtyp":"9006","sgtxt":"201910-201910 FR CDR-CP_FR_100010_1","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20191120","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20191120","wrbtr":"-53584.72","waers":"EUR","augdt":"20191120","augbl":"0200093926","zfbdt":"20191120","bvtyp":"","sgtxt":"","reBillingid":"91120-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191130","bukrs":"3058","blart":"MI","vbelnVf":"9058226799","bldat":"20191130","wrbtr":"53294.81","waers":"EUR","augdt":"20191220","augbl":"0200104496","zfbdt":"20191220","bvtyp":"9006","sgtxt":"201911-201911 FR CDR-CP_FR_100010_1","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20191130","bukrs":"3058","blart":"MI","vbelnVf":"9058226764","bldat":"20191130","wrbtr":"53309.76","waers":"EUR","augdt":"20191220","augbl":"0200104496","zfbdt":"20191220","bvtyp":"9006","sgtxt":"201910-201910 FR CDR-CP_FR_100010_1","reBillingid":"0000300426"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191130","bukrs":"3058","blart":"MK","vbelnVf":"9058226718","bldat":"20191130","wrbtr":"-53608.43","waers":"EUR","augdt":"20191220","augbl":"0200104496","zfbdt":"20191120","bvtyp":"9006","sgtxt":"201910-201910 FR CDR-CP_FR_100010_1","reBillingid":"0000296809"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191220","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20191220","wrbtr":"-52996.14","waers":"EUR","augdt":"20191220","augbl":"0200104496","zfbdt":"20191220","bvtyp":"","sgtxt":"","reBillingid":"91220-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191227","bukrs":"3058","blart":"MI","vbelnVf":"9058230197","bldat":"20191227","wrbtr":"20909.07","waers":"EUR","augdt":"20200117","augbl":"0003900175","zfbdt":"20200119","bvtyp":"","sgtxt":"FR,D06,202001,MAFR_100010,FCC","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20191231","bukrs":"3058","blart":"MI","vbelnVf":"9058230976","bldat":"20191231","wrbtr":"52786.40","waers":"EUR","augdt":"20200120","augbl":"0200003026","zfbdt":"20200120","bvtyp":"9006","sgtxt":"201911-201911 FR CDR-CP_FR_100010_1","reBillingid":"0000305740"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191231","bukrs":"3058","blart":"MK","vbelnVf":"9058230929","bldat":"20191231","wrbtr":"-53294.81","waers":"EUR","augdt":"20200120","augbl":"0200003026","zfbdt":"20191220","bvtyp":"9006","sgtxt":"201911-201911 FR CDR-CP_FR_100010_1","reBillingid":"0000300476"},{"kunnr":"0000081599","cp":"100010","fkdat":"20191231","bukrs":"3058","blart":"MI","vbelnVf":"9058230286","bldat":"20191231","wrbtr":"76806.85","waers":"EUR","augdt":"20200120","augbl":"0200003026","zfbdt":"20200120","bvtyp":"9006","sgtxt":"201912-201912 FR CDR-CP_FR_100010_1","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20200117","bukrs":"3058","blart":"MK","vbelnVf":"9058232884","bldat":"20191227","wrbtr":"-20909.07","waers":"EUR","augdt":"20200117","augbl":"0003900175","zfbdt":"20200119","bvtyp":"","sgtxt":"FR,D06,202001,MAFR_100010,FCC","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20200117","bukrs":"3058","blart":"MI","vbelnVf":"9058232908","bldat":"20200117","wrbtr":"20909.07","waers":"EUR","augdt":"20200120","augbl":"0200003025","zfbdt":"20200119","bvtyp":"","sgtxt":"FR,D06,202001,MAFR_100010,FCC","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20200120","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20200120","wrbtr":"-20909.07","waers":"EUR","augdt":"20200120","augbl":"0200003025","zfbdt":"20200120","bvtyp":"","sgtxt":"","reBillingid":"00120-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200120","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20200120","wrbtr":"-76298.44","waers":"EUR","augdt":"20200120","augbl":"0200003026","zfbdt":"20200120","bvtyp":"","sgtxt":"","reBillingid":"00120-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200131","bukrs":"3058","blart":"MI","vbelnVf":"9058233996","bldat":"20200131","wrbtr":"70907.92","waers":"EUR","augdt":"20200220","augbl":"0200012001","zfbdt":"20200220","bvtyp":"9006","sgtxt":"202001-202001 FR CDR-CP_FR_100010_SP","reBillingid":""},{"kunnr":"0000081599","cp":"100010","fkdat":"20200131","bukrs":"3058","blart":"MI","vbelnVf":"9058233962","bldat":"20200131","wrbtr":"76542.48","waers":"EUR","augdt":"20200220","augbl":"0200012001","zfbdt":"20200220","bvtyp":"9006","sgtxt":"201912-201912 FR CDR-CP_FR_100010_SP","reBillingid":"0000311980"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200131","bukrs":"3058","blart":"MK","vbelnVf":"9058233912","bldat":"20200131","wrbtr":"-76806.85","waers":"EUR","augdt":"20200220","augbl":"0200012001","zfbdt":"20200120","bvtyp":"9006","sgtxt":"201912-201912 FR CDR-CP_FR_100010_1","reBillingid":"0000305616"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200220","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20200220","wrbtr":"-70643.55","waers":"EUR","augdt":"20200220","augbl":"0200012001","zfbdt":"20200220","bvtyp":"","sgtxt":"","reBillingid":"00220-Q5812"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200229","bukrs":"3058","blart":"MI","vbelnVf":"9058237576","bldat":"20200229","wrbtr":"70671.02","waers":"EUR","augdt":"20200320","augbl":"0200021039","zfbdt":"20200320","bvtyp":"9006","sgtxt":"202001-202001 FR CDR-CP_FR_100010_SP","reBillingid":"0000315140"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200229","bukrs":"3058","blart":"MK","vbelnVf":"9058237244","bldat":"20200229","wrbtr":"-70907.92","waers":"EUR","augdt":"20200320","augbl":"0200021039","zfbdt":"20200220","bvtyp":"9006","sgtxt":"202001-202001 FR CDR-CP_FR_100010_SP","reBillingid":"0000312043"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200229","bukrs":"3058","blart":"MI","vbelnVf":"9058237664","bldat":"20200229","wrbtr":"75765.50","waers":"EUR","augdt":"20200320","augbl":"0200021039","zfbdt":"20200320","bvtyp":"9006","sgtxt":"202002-202002 FR CDR-CP_FR_100010_SP","reBillingid":"0000315196"},{"kunnr":"0000081599","cp":"100010","fkdat":"20200320","bukrs":"3058","blart":"ZP","vbelnVf":"","bldat":"20200320","wrbtr":"-75528.60","waers":"EUR","augdt":"20200320","augbl":"0200021039","zfbdt":"20200320","bvtyp":"","sgtxt":"","reBillingid":"00320-Q5812"}]')
                .build();
        endpointToResponseMap.put(msUtility.getMetadata().Payments_Endpoint__c, responseSuccess);
        Test.setMock(HttpCalloutMock.class, new msCalloutMock(endpointToResponseMap));
        //User testUser = [SELECT Id, Name, ContactId FROM User WHERE Username = 'DEtestuser@statkraft.mindsquare.apex.testuser.statkraftportal'];

        System.Test.startTest();
        System.runAs(testUser) {
            msPaymentController.PaymentResponseWrapper paymentWrapper = msPaymentController.getPayment(null);

            System.Test.stopTest();
            System.assert(!paymentWrapper.payments.isEmpty(), 'Failed to parse payment');
        }
    }
}